const x=Symbol("ps"),aa=Symbol("pks"),B=Symbol("ed"),C=Symbol("gr"),I=Symbol("gx"),ba=Symbol("gpr"),J=Symbol("gd"),L=Symbol("gl"),ca=Symbol("glw"),M=Symbol("ga"),da=Symbol("gai"),N=Symbol("gr");let ea=!1;const fa=new Map,ha=new Map;let O=null;
function ia(a,c,b,d=!1){ja();var e=c[C];if(e)for(const g of e)g&&(g===O||(g.u===5?fa:ha).set(g,a));else if(e===null)return;e=a!==null&&typeof a==="object";for(var f in c)e&&Object.prototype.hasOwnProperty.call(a,f)?ia(a[f],c[f],f,!0):ka(c[f]);if(!d){b===""?d=c[I]?.[x]?.path.split(".")??[]:(d=c[ba]?.[I]?.[x]?.path.split(".")??[],d.push(b));f=d.length-1;for(let g=c[ba],l=f;g&&g[ba];g=g[ba],l--){if(g[M])for(let k=l,r=g[d[k]];r&&k<=f;r=r[d[++k]])k===f&&ia(a,r,b,!0);if(c=g[C]){e=g[I]?.[x].path+".";for(const k of c)if(k.u===
2||k.Y&&k.Y.has(e))k===O||(k.u===5?fa:ha).set(k,null)}}}}function la(a,c){if(a!==O)if(O===null)ma(a,c);else{var b=O;O=a;(a.u===5?fa:ha).delete(a);ma(a,c);O=b}}function na(a){if(a=a[C])for(const c of a)c.m===1&&la(c,null)}function ma(a,c){let b;try{b=a.update.call(null,a.g[I],a.g[N],a,c),b instanceof Promise&&b.catch(d=>{oa(d,a)})}catch(d){oa(d,a);return}c=a.s;c===""||a.m!==1&&a.l[c]===b||(a.m=3,a.l[c]=b)}
function S(a,c,b,...d){let e;try{e=a.call(b,...d),e instanceof Promise&&(e=e.catch(f=>{oa(f,c)}))}catch(f){oa(f,c)}return e}
function U(a,c,b,d){if(b.length>0){const f=pa(c,b);if(f.g!==c){if(!f.$)return U(a,f.g,b,d??c[C]);var e=U(a,f.g,f.$,d??c[C]);b=f.j}for(let g=0,l=b.length;g<l;g++)e=b[g],e[e.length-1]==="["&&((a.Y??(a.Y=new Set)).add(c[J].path+"."+e.replace(/\[|\]/g,k=>k==="["?".":"")),e=e.slice(0,-1)),e=qa(c,e),e[C].add(a),a.B&&a.B.add(e);(c=d??c[C])&&c.add(a);a.u!==2&&a.l&&a.s!==""&&a.l[a.s]!==a.C&&(a.l[a.s]=a.C)}else ma(a,null);return e}function ra(a,c){const b=pa(a,[c]);return b.g!==a?ra(b.g,c):qa(a,c)}
function qa(a,c){let b=a;c[c.length-1]==="["&&(c=c.slice(0,-1));const d=c.match(/[^.[\]]+/g)||[];for(let f=0;f<d.length;f++){const g=d[f];if(b[g]===void 0){var e=b[I];if(e&&!Object.prototype.hasOwnProperty.call(e,g)&&(console.warn("createGraphNode: missing state for path/prop",c,"/",g),e=a[J].D)){const l=g.toLowerCase();(e.hasAttribute("p:"+l)||e.hasAttribute("pm:"+l))&&console.warn("possible kebab-cased to camelCased mismatch for prop",g)}b[g]=sa(b)}b=b[g]}return b}
function W(){this.s!==""&&(this.l[this.s]=this.C)}function ka(a){if(a){var c=a[C];if(c)for(const b of c)b.m>2&&(b.G(),b.m=2);a[I]&&(a[I]=null);for(const b in a)ka(a[b])}}
function ta(a,c){try{a[J].D?.[B].N?.kill?.call(null,a[I],a[N])}catch(l){console.error("RunnerUtils.killTemplate: LifeCycle.kill error",l)}var b=c[J].U;if(b)for(let l=0,k=b.length;l<k;l++)if(b[l]===a){b.splice(l,1);break}for(b=[a];b.length>0;){var d=b.pop(),e=d[C];if(e)for(var f of e){if(f.u===5){e=f.l;const l=e[M];if(l){for(let k=l.length-1;k>=0;k--)if(l.hasOwnProperty(k)){const r=l[k][J];for(let t=r.length-1;t>=0;t--){const w=r[t];w[J].ca===d&&(ta(w,d),r.splice(t,1))}r.length===0&&l.pop()}l.length===
0&&(e[da]=void 0)}}if(f.B){for(var g of f.B)(e=g[C])&&e.delete(f);f.B.clear()}(f.u===5?fa:ha).delete(f)}(d=d[J]?.U)&&b.push(...d)}a[L]=void 0;a[C]=void 0;a[I]=null;a[ba]=void 0;f=a[J];if(!f)console.warn("killTemplate: G_DATA not found, possible template initialization error");else if(f.D){b=f.D;g=ua(b);d=b[B].I;if(d!==4){if(d===3&&f.T){for(const [l,k]of f.T){if(l[0]==="$"){const {l:r,s:t}=va(l.substring(3),c[N],!0);r&&r[t]===k&&(r[t]=void 0)}k[aa]=!0}f.T.clear()}b[B]=void 0;b.remove()}else for(b[B]=
{I:d},c=b.shadowRoot??b;c.lastChild;)c.removeChild(c.lastChild);f.D=void 0;g&&g.remove()}a[J]=void 0}function ja(){ea||(Promise.resolve().then(()=>{do{for(const c of fa){var a=c[0];O=a;fa.delete(a);ma(a,c[1])}for(const c of ha)if(O=a=c[0],ha.delete(a),ma(a,c[1]),fa.size>0)break}while(fa.size>0||ha.size>0);ea=!1;O=null}),ea=!0)}
function pa(a,c){const b=a[L]?.[ca];if(b){var d=b.O;if(d){const e=[],f=[],[g,l]=d;for(d=0;d<c.length;d++){const k=c[d];(k===g||k===l||k.startsWith(g+".")||k.startsWith(g+"[")?f:e).push(k)}if(e.length>0)return{g:b.g,j:f,$:e}}else a=b.g}return{g:a,j:c,$:void 0}}
function oa(a,c){console.error("RunnerUtils.handleExecError: error:",a);const b=a instanceof Error?a:Error(typeof a==="string"?a:"unknown error",{cause:a});if(c instanceof Element)var d=c;else if(c.l){var e=c.l;e instanceof Element?d=e:e instanceof Text?d=e.parentElement:e.ownerElement&&(d=e.ownerElement);if(!d)if(e=c.g[J],e.D)d=e.D;else for(let f=0,g=e.U.length;f<g;f++){const l=e.U[f][J];if(l.D){d=l.D.parentElement;break}}}if(!d)throw console.error("RunnerUtils.handleExecError: cannot find Element for runner",
c),b;for(c=!1;d;){if(d.nodeType===Node.ELEMENT_NODE&&d.hasAttribute("error")){d[B].aa&&(d=d[B].aa,d.h.call(null,d.g[I],d.g[N],b),c=!0);break}if(d[B]?.I===1)break;d=d.parentElement||ua(d)}if(!c)throw a;}
function wa(a,c,b,d=!1){let e,f;return new Proxy(a,{get(g,l){return l==="emit"?(e||(e=c?function(k,r,t=!1){t=t===!0;c.dispatchEvent(new CustomEvent(k,{detail:r,bubbles:t,composed:t}))}:a.global.emit),e):l==="watch"?(f||(f=function(k,r,t){const w=Y(Z(k),b[J].path,4);U({l:null,s:"",u:1,m:1,H:t,update:function(D,h,m){m.H===!1?m.H=!0:r(w.h.call(null,D,h))},G:W,C:void 0,g:b,B:new Set},b,w.A.j)}),f):g.local?.[l]??(d?void 0:g.global[l])},set(g,l,k){g.local||(g.local={});g.local[l]=k;return!0}})}
function xa(a,c,b){let d=/\bthis\b/.test(b.A.o)?ya(c):null;const e=a[J];d&&e.D&&3===e.D[B].I&&(e.T??(e.T=new Map)).set(Math.random().toString(36),d);S(b.h,c,d,a[I],a[N])}
function ya(a){let c=a;return new Proxy({},{get(b,d){if(d==="__raw")return c;za(c);const e=c[d];return typeof e==="function"?function(...f){return e.apply(c,f)}:e},set(b,d,e){if(d===aa)return c=void 0,!0;za(c);c[d]=e;return!0},has(b,d){za(c);return d in c},deleteProperty(b,d){za(c);return delete c[d]},ownKeys(){za(c);return Reflect.ownKeys(c)},getOwnPropertyDescriptor(b,d){za(c);return Reflect.getOwnPropertyDescriptor(c,d)},getPrototypeOf(){za(c);return Object.getPrototypeOf(c)}})}
function za(a){if(!a)throw ReferenceError("element is not defined");};const Aa=Object.getPrototypeOf(async function(){}).constructor;let Ba=0;function Ca(){let a="",c=Ba++;do{const b=c%52;a=String.fromCharCode(b+(b<26?97:39))+a;c=Math.floor(c/52)-1}while(c>=0);return a}function Z(a){return/^\s*{{/.test(a)?a.replace(/^\s*{{\s*|\s*}}\s*$/g,""):a.trim()!==""&&Number.isFinite(+a)?a:"'"+a.replace(/'/g,"\\'")+"'"}const Da=new Map;
function Y(a,c,b=1,d=""){d=c+a+d+b;var e=Da.get(d);if(!e){e=c;const l=a.length;if(l>512)throw Error("expression is too long (max length: 512)");let k="";const r=new Set;e+=e?".":"";for(let t=0,w=0,D="",h="",m=!1;t<=l;t++){var f=l!==t?a[t]:"";if(w===0)f==='"'||f==="'"||f==="`"?(w=1,D=f,k+=f):/[a-zA-Z_$]/.test(f)?(w=2,h=f):f==="]"||f===")"?(w=3,h=f):(f==="{"?(m=!0,w=1,D=":"):f==="}"?m=!1:m&&f===","&&(w=1,D=":"),k+=f);else if(w===1){if(f===D)w=0;else if(m&&f==="."&&(a[t+1]||"")==="."&&(a[t+2]||"")===
".")w=0,t+=2,k+="..";else if(f==="\\"){k+=f+(a[t+1]||"\\");t++;continue}k+=f}else if(/[\w.$\d]/.test(f))h+=f;else if(f==="?"&&(a[t+1]||"")===".")h+=f;else{if(f==="["||f==="("){if(h+=f,f=a.substring(t+1).match(/^\s*(?:\d+|'(?:0x[0-9a-fA-F]+|[0-9]+)'|"(?:0x[0-9a-fA-F]+|[0-9]+)")\s*\]/)){h+=f[0];t+=f[0].length;continue}}else--t;if(h==="true"||h==="false"||h==="null"||h==="undefined"||h==="void"||h==="this"||h==="$evt"||h==="$err"||h==="await"||h==="return"||h.startsWith("$r.")||h.startsWith("$err.")||
h.startsWith("$evt.")||h.startsWith("this.")||h.startsWith("void("))k+=h;else{f=h;var g=w===3||/[\])]/.test(h[0])||/[[(]/.test(h[h.length-1]);const n=f.replace(/\s*/g,"").replace(/\?\./g,"."),A=n[0];let v=-1;g?(A!=="]"&&A!==")"&&(k+=e,n[n.length-1]==="("&&(v=n.lastIndexOf("."))),A!=="]"&&n[n.length-1]==="["&&(r.delete(n.slice(0,-1)),r.add(n))):(r.add(n),k+=e);v!==-1&&r.add(n.substring(0,v));k+=f}w=0}}e={o:k,j:Array.from(r),ja:[]};e={A:e,h:b>2?new (/^\s*await\b/.test(a)?Aa:Function)(c,"$r",(b===3?
"":"return ")+e.o):null};b>1&&Da.set(d,e)}return e}function Fa(a,c,b){const d=c[J];b={[J]:{path:d.path+"_"+Ca(),D:a,U:[]},[C]:b?new Set:c[C],[I]:null};const e=a?.[B];b[N]=e&&e.I===3?c[N]:wa({global:c[N]},a,b,a?.hasAttribute("no-refs"));e&&e.L&&(e.L.g=c);d.U.push(b);return b}function sa(a){return{[C]:new Set,[ba]:a,[I]:null}}function Ga(a){if(!a)return!1;const c=a.length;for(let b=0;b<c;b++){const d=a.charCodeAt(b);if(d<48||d>57)return!1}return c===1||a[0]!=="0"}
function Ha(a){return a.replace(/-./g,c=>c.toUpperCase()[1])}function va(a,c,b=!1){a=a.replace(/\[/g,"[.").replace(/\]/g,"").split(".");if(a.length<1)return{l:null,s:""};for(let d=0;d<a.length-1;d++){let e=a[d];const f=a[d].endsWith("[");f&&(e=e.slice(0,-1));if(c[e]===void 0){if(b)return{l:null,s:""};c[e]=f?[]:{}}c=c[e]}return{l:c,s:a[a.length-1]}}
function Ia(a){if(a==="")a=document.createElement("div"),a.style.display="inline";else{const [c,b]=a.split("|");a=document.createElement(c.trim());b&&(a.style.cssText=b)}return a}function ua(a){a=a.getRootNode();return a instanceof ShadowRoot?a.host:null}function Ja(a,c,b){const d=b.H;var e=d.p;const f=d.i;a=d.f.call(null,a,c);a!==e[f]&&(e[f]=a,e=e.join(""),b.l.value!==e&&(b.l.value=e))}
function Ka(a,c){c=c.match(/[^.[\]]+/g)||[];for(let b=0;b<c.length;b++){const d=c[b];if(!Object.hasOwnProperty.call(a,d))return;a=a[d]}return a};function La(a,c,b){const d={target:a,path:c,v:b,K:void 0},e=Array.isArray(a);e&&!d.v[M]&&(d.v[M]=[]);let f=!1;return new Proxy(a,{set(g,l,k){var r=String(l);const t=d.v[L];if(t){let w;if((w=t[l])!==void 0){if(w.h===null)return console.error("proxy set: linker(null fun): read-only var",d.path+"."+r),!0;if(!w.J)return console.error('proxy set: one way linker, use "pm:" or events',d.path+"."+r),!0;r=w.h.call(null,w.g[I]);r[w.F]!==k&&(r[w.F]=k);return!0}if(!((w=t[ca])===void 0||w.O&&w.O.includes(r)))return g=
w.g[I],g[r]!==k&&(g[r]=k),!0}g[l]=k;if(f)return!0;if(e){if(r==="length"||Ga(r))f=!0,ia(g,d.v,""),Promise.resolve().then(()=>{f=!1});return!0}k=d.v[r]??(d.v[r]=sa(d.v));Object.hasOwnProperty.call(k,I)&&(k[I]=g[l],ia(g[l],k,r));return!0},get(g,l){if(l===x)return d;const k=String(l);let r=g[l];if(r===void 0){var t=d.v[L];if(t){if((g=t[k])!==void 0){if(g.h===null)return g.F;l=g.h.call(null,g.g[I]);if(g.J)return l[g.F];l=l[x];l.K||(l.K=Ma(l));return l.K[g.F]}if(!((g=t[ca])===void 0||g.O&&g.O.includes(k)))return g.g[I]?.[l]}}else r===
null||typeof r!=="object"||r[x]||(t=e?d.v[M]:d.v,t=t[k]??(t[k]=sa(d.v)),r=La(r,d.path+"."+k,t),g[l]=t[I]=r);return r},deleteProperty(g,l){const k=String(l);e&&Ga(k)&&g.hasOwnProperty(k)&&!f&&(f=!0,ia(g,d.v,""),Promise.resolve().then(()=>{f=!1}));return delete g[l]}})}const Na=new Set("push pop unshift shift splice sort reverse fill copyWithin".split(" "));function Oa(){}
function Ma(a){const c=Array.isArray(a.target);return new Proxy(a.target,{set(b,d){console.error('read-only proxy(set): use "pm:" or events, cannot set read-only var',a.path+"["+String(d)+"]");return!0},get(b,d){if(d===x)return a;var e=String(d);let f=b[d];if(f===void 0){var g=a.v[L];if(g){if((b=g[e])!==void 0){if(b.h===null)return b.F;d=b.h.call(null,b.g[I])[x];d.K||(d.K=Ma(d));return d.K[b.F]}if(!((b=g[ca])===void 0||b.O&&b.O.includes(e)))return b.g[I]?.[d]}}else if(f!==null&&typeof f==="object")g=
f[x],g||(g=c?a.v[M]:a.v,g=g[e]??(g[e]=sa(a.v)),e=La(f,a.path+"."+e,g),b[d]=g[I]=e,g=e[x]),g.K||(g.K=Ma(g)),f=g.K;else if(c&&Na.has(e))return console.error('read-only proxy(get): use "pm:" or events, method not available',e),Oa;return f},deleteProperty(b,d){console.error('read-only proxy(delete): use "pm:" or events, delete not allowed on path',a.path+"["+String(d)+"]");return!1}})};function Pa(a,c){let b=a.id;if(c.has(b))return console.error("initTemplate: template already exist with, using cached id",b),c.get(b);var d=a.content.querySelectorAll("script"),e;d.length>0&&(d.length!==1?console.error("template has more than one script tag, templateId:",b,"(initTemplate)"):e=(new Function('"use strict";'+d[0].textContent+';return{create:typeof create==="function"?create:null,kill:typeof kill==="function"?kill:null}')).call(null),d.forEach(r=>r.remove()));if(d=a.getAttribute("wrap")){d=
document.createElement(d);d.appendChild(a.content.cloneNode(!0));var f=a.attributes;for(var g=0;g<f.length;g++){var l=f[g],k=l.name;["wrap","id"].indexOf(k)===-1&&d.setAttribute(k,l.value)}}else{d=a.content;f=0;for(g=d.firstChild;g&&!(f>1);){if(g.nodeType===Node.TEXT_NODE){if(g.nodeValue?.trim()){f=0;break}}else f++;g=g.nextSibling}if(f===1&&d.firstElementChild)for(d=d.firstElementChild.cloneNode(!0),f=a.attributes,g=0;g<f.length;g++)l=f[g],k=l.name,k.startsWith("p:")&&d.setAttribute(k,l.value);else throw Error('initTemplate: templates must have exactly one Element child or "wrap" attr');
}a.remove();a=d.querySelectorAll("template");f=d[B]??(d[B]={});e&&(f.N=e);for(e=a.length-1;e>=0;e--)g=a[e],g.hasAttribute("id")&&!g.hasAttribute("shadowrootmode")&&(f.P||(f.P=new Map),Pa(g,f.P));c.set(b,d);return d}
function Qa(a,c,b,d){if(a.tagName.startsWith("R-")){if(c===null)throw Error("applyTemplate: cache is null");c=Ra(a,c,b,d);if(!c)return null;a.hasAttribute("shadow")?(d=Ia(a.getAttribute("shadow")),d.attachShadow({mode:"open"}).appendChild(c)):d=c;b?b.after(d):a.before(d);a.remove();return c}if(!b)return console.error("applyTemplate: inline template: anchor is not defined"),null;a=a.cloneNode(!0);b.after(a);a[B]={I:3};return a}
function Ra(a,c,b,d){var e=a.tagName.slice(2).toLowerCase();if(d=d?.get(e)??c.get(e))c=d;else{d=document.getElementById(e);if(!d||d.tagName!=="TEMPLATE")throw Error("applyTemplate: template not found, templateId: "+e);c=Pa(d,c)}for(b=b?.parentElement||a.parentElement;b&&b[B]?.I!==1;b=b.parentElement||ua(b))if(b[B]?.ia===e)return console.error("applyTemplate: infinite template recursion detected, templateId:",e),null;b=c.cloneNode(!0);d=[];const f=a.attributes;for(let g=0;g<f.length;g++){const l=f[g],
k=l.name;k.startsWith("p:")?b.removeAttribute("pm:"+k.substring(2)):k.startsWith("pm:")?b.removeAttribute("p:"+k.substring(3)):d.push(k);b.setAttribute(k,l.value)}b[B]={ia:e,I:2,ea:d};c[B]?.P&&(b[B].P=c[B].P);if(a.textContent.trim()!==""&&b.getElementsByTagName("slot").length>0){for(e=document.createDocumentFragment();a.firstChild;)e.appendChild(a.firstChild);a[B]={V:e};b[B].L={g:null,V:e}}else a[B]?.V&&(b[B].L={g:null,V:a[B].V});c[B].N&&(b[B].N=c[B].N);return b};function Sa(a,c,b,d){a=b.l;if(a[da])if(b=d?.[x]?.target??a[da]?.h(b.g)?.[x].target??d,Array.isArray(b)&&b.length!==0){if(d=Ta(a),d.length>0){c=new Map;let w=!1;const D=a[M];var e=null;for(let h=0,m=b.length;h<m;h++)if(b.hasOwnProperty(h)){var f=b[h],g=D[h];if(g){var l=g[I];if(l===f){a:{l=c;var k=h,r=l.get(f);if(r)for(let n=0,A=r.length;n<A;n++){var t=r[n];if(Math.abs(t)===k){r.splice(n,1);r.length===0&&l.delete(f);l=t<0;break a}}l=!1}if(l)Ua(e,h,g,a,d);else if(!g[J]||g[J].length!==d.length)a:for(f=
g,l=h,f=f[J]??(f[J]=[]),k=0;k<d.length;k++){r=d[k];t=r.g;for(let n=0;n<f.length;n++)if(f[n][J].ca===t)continue a;Va(e,k,r.H.anchor).after(Wa(l,a,r))}e=g}else if(w||(Xa(c,D,h),w=!0),f=Ya(c,f),f!==void 0)if(l=Math.abs(f),l===h)f<0&&Ua(e,h,g,a,d),e=g;else{f=D[l];if(!f)throw Error("List.doSync: nodeForValue is undefined, indexOfNodeForValue: "+l);ab(c,g[I],h,-l);D[l]=g;Ua(e,h,f,a,d);e=D[h]=f}else D.push(g),ab(c,l,h,-(D.length-1)),e=bb(e,h,a,d)}else w||(Xa(c,D,h+1),w=!0),g=Ya(c,f),g!==void 0?(g=Math.abs(g),
l=D[g],delete D[g],Ua(e,h,l,a,d),e=l):e=bb(e,h,a,d)}else if(g=D[h])delete D[h],D.push(g),ab(c,g[I],h,-(D.length-1));if(D.length>b.length)for(let h=D.length-1,m=b.length-1;h>m;h--)D.hasOwnProperty(h)&&cb(D[h],d),D.splice(h,1)}}else if(b=a[M])for(a=Ta(a),d=b.length-1;d>=0;d--)b.hasOwnProperty(d)&&cb(b[d],a),b.pop()}
function bb(a,c,b,d){const e=Object.assign(sa(b),{[J]:[]});b[M][c]=e;e[I]=b[I]?.[c]??null;var f=b[I]?.[c]?.[x];f&&(f.v!==e&&(f.v=e),f.path=b[I]?.[x].path+"."+c);for(let g=0,l=d.length;g<l;g++)f=d[g],Va(a,g,f.H.anchor).after(Wa(c,b,f));return e}
function Wa(a,c,b){var d=b.H;const e=d.Z.cloneNode(!0);e[B]=d.Z[B];var f=c[M][a];b=b.g;const g=Fa(e,b,!0);g[J].ca=b;const l=g[J].path,k=d.ba,r=k[0].name;var t=k[1].name,w=g[L]={[r]:{g:c,h:h=>h,F:a,J:k[0].type===2}};const D={};t&&(w[t]={g,h:null,F:a,J:!1},D[t]=void 0);if(d.Z[B].I===3)g[L][ca]={g:b,h:()=>{},F:"",J:!0,O:t?[r,t]:[r]};else for(a=b[J].path,d=2;d<k.length;d++){t=k[d];w=t.o;if(t.type===4){D[t.name]=w;continue}const h=ra(b,w);if(h){const m=t.name,n=g[L]??(g[L]={}),A=w.lastIndexOf(".");n[m]=
{g:b,h:new Function(a,"return "+a+(A===-1?"":"."+w.substring(0,A))),F:w.substring(A+1),J:t.type===2};g[m]=h}else console.error("List.createAndLinkElement: missing linkToNode: cannot bind to expression",w)}g[r]=f;f[J].push(g);g[I]=La(D,l,g);(f=e[B].N?.create)&&S(f,e,null,g[I],g[N]);c[da].ha(g,e,!1,b);na(g);return e}
function Ua(a,c,b,d,e){var f=d[I]?.[c];if(f){var g=f[x];g&&(f[x].v=b,g.path=d[I]?.[x].path+"."+c);b[I]=f}else b[I]=null;d[M][c]=b;b=b[J];for(let k=0,r=b.length;k<r;k++){g=b[k];f=g[J];d=e[k].H;const t=g[L];if(t){var l=d.ba;t[l[0].name].F=c;if(l=l[1].name)if(t[l].F=c,g=g[l]?.[C])for(const w of g)la(w,c)}(f=f.D)&&Va(a,k,d.anchor).after(f)}}function cb(a,c){if(a=a[J]){for(let b=0,d=a.length;b<d;b++)ta(a[b],c[b].g);a.length=0}}
function Xa(a,c,b){for(let d=b,e=c.length;d<e;d++)if(b=c[d])b=b[I],a.get(b)?.push(d)??a.set(b,[d])}function Ya(a,c){const b=a.get(c);if(b){const d=b.pop();b.length===0&&a.delete(c);return d}}function ab(a,c,b,d){const e=a.get(c);if(e){for(let f=0,g=e.length;f<g;f++)if(Math.abs(e[f])===b){e[f]=d;return}e.push(d)}else a.set(c,[d])}function Ta(a){const c=[];if(a=a[C])for(const b of a)b&&b.u===5&&c.push(b);return c}function Va(a,c,b){return a?a[J][c]?.[J].D??b:b};function db(a,c,b){const d=b[J].path;c=Z(c);const {A:e,h:f}=Y(c,d,4);if(e.j.length!==1||e.j[0]!==c)console.error('model: only "simple" vars are supported: invalid varName:',c,"(text input)");else if(U({l:a,s:"value",u:1,m:1,update:f,G:W,C:"",g:b,B:new Set},b,e.j),eb(c,b))a.readOnly=!0,a.addEventListener("keydown",fb);else{var g=new Function(d,"$r","_v",`${e.o}=_v`);a.addEventListener("input",l=>{S(g,a,null,b[I],b[N],l.currentTarget.value)})}}
function gb(a,c,b){c=Z(c);let d=!1;c.endsWith("[]")&&(d=!0,c=c.slice(0,-2));const e=b[J].path,f=Y(c,e,2,"_chb_m_"+e+"_"+d),g=f.A;if(g.j.length!==1||g.j[0]!==c)console.error('model: only "simple" vars are supported: invalid varName:',c,"(checkbox)");else{if(!f.h){const t=new Function(e,"$r",`return ${g.o}`);f.h=d?function(w,D,h){w=t.call(null,w,D);return Array.isArray(w)&&w.includes(h.H[0])}:function(w,D,h){return t.call(null,w,D)===h.H[0]}}a.hasAttribute("name")||(a.name=c);var l=[!0,!1];if(a.hasAttribute("value")){var k=
a.value;k.trim().startsWith("{{")?({h:k}=Y(Z(k),e,4),k=k.call(null,b[I],b[N]),Array.isArray(k)?(k.hasOwnProperty(0)&&(l[0]=k[0]),k.hasOwnProperty(1)&&(l[1]=k[1])):l[0]=k):l[0]=(new Function("return "+Z(k)))()}a.value=l[0];k=Ka(b[I],c);a.checked=k!==void 0?d?Array.isArray(k)&&k.includes(l[0]):k===l[0]:!1;U({l:a,s:"checked",u:1,m:1,H:l,update:f.h,G:W,C:a.checked,g:b,B:new Set},b,g.j);if(eb(c,b))a.addEventListener("click",fb),a.addEventListener("keydown",fb);else{var r=d?new Function(e,"$r","_checked",
"_v","_fun",`if(!_fun(${g.o},_checked,_v)){${g.o}=[_v]}`):new Function(e,"$r","_v",`${g.o} = _v`);a.addEventListener("change",t=>{t=t.currentTarget.checked;d?S(r,a,null,b[I],b[N],t,l[0],hb):S(r,a,null,b[I],b[N],l[t?0:1])})}}}
function ib(a,c,b){if(a.hasAttribute("value")){c=Z(c);var d=b[J].path,e=Y(c,d,2,"_r_r_m+"+d),f=e.A;if(f.j.length!==1||f.j[0]!==c)console.error('model: only "simple" vars are supported: invalid varName:',c,"(radio)");else{if(!e.h){const r=new Function(d,"$r",`return ${f.o}`);e.h=function(t,w,D){return r.call(null,t,w)===D.H}}var g=a.value;if(g.trim().startsWith("{{")){var {h:l}=Y(Z(g),d,4);g=l.call(null,b[I],b[N]);a.value=g}else g=a.value;a.hasAttribute("name")||(a.name=c);l=Ka(b[I],c);a.checked=l===
g;U({l:a,s:"checked",u:1,m:1,H:g,update:e.h,G:W,C:a.checked,g:b,B:new Set},b,f.j);if(eb(c,b))a.addEventListener("click",fb),a.addEventListener("keydown",fb);else{var k=new Function(d,"$r","_v",`${f.o} = _v`);a.addEventListener("change",()=>{S(k,a,null,b[I],b[N],g)})}}}else console.error('initRadio: element missing "value" attr',a)}
function jb(a,c,b){const d=a.hasAttribute("multiple");var e=b[J].path;c=Z(c);const f=Y(c,e,2,"_sel_m_"+e+"_"+d),g=f.A;if(g.j.length!==1||g.j[0]!==c)console.error('model: only "simple" vars are supported: invalid varName:',c,"(select)");else{var l=d?new Function(e,"$r",`if(!Array.isArray(${g.o})){${g.o}=[]}return ${g.o}`):new Function(e,"$r","_v",`${g.o}=_v`);f.h||(f.h=d?function(k,r,t){k=l.call(null,k,r);t=t.l.options;k=Array.isArray(k)?k:[k];for(let w=0,D=t.length;w<D;w++){r=t[w];const h=r.value;
r.selected?k.includes(h)||(r.selected=!1):k.includes(h)&&(r.selected=!0)}}:new Function(e,"$r",`return ${g.o}`));e=S(new Function(e,"$r",`return ${g.o}`),a,null,b[I],b[N]);a.value=e;U({l:a,s:d?"":"value",u:1,m:1,update:f.h,G:W,C:e,g:b,B:new Set},b,g.j);eb(c,b)?(a.addEventListener("mousedown",fb),a.addEventListener("keydown",fb)):a.addEventListener("change",k=>{k=k.currentTarget.options;if(d){var r=S(l,a,null,b[I],b[N])??[];for(let w=0,D=k.length;w<D;w++){var t=k[w];const h=t.value;t.selected?r.includes(h)||
r.push(h):(t=r.indexOf(h),t!==-1&&r.splice(t,1))}}else for(let w=0,D=k.length;w<D;w++)if(r=k[w],r.selected){S(l,a,null,b[I],b[N],r.value);break}})}}function hb(a,c,b){if(c)if(Array.isArray(a))a.push(b);else return!1;else Array.isArray(a)&&(c=a.indexOf(b),c!==-1&&a.splice(c,1));return!0}function fb(a){console.error('model(read-only): use "pm:" or events, cannot update "model" prop:',a.currentTarget.getAttribute("model"));a.preventDefault();a.stopPropagation();return!1}
function eb(a,c){return(a=c[L]&&c[L][(a.match(/[^.[\]]+/g)||[])[0]||""])?!a.J:!1};const kb=new Set(["ref","model","view","error"]);
function lb(a,c){function b(h,m,n=!1,A){const v=document.createNodeIterator(m,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);n&&v.nextNode();n=h[J].path;const F=m[B]?.P;for(var p=v.nextNode();p!==null;p=v.nextNode())if(p.nodeType===Node.TEXT_NODE){var u=p.nodeValue.indexOf("{{");if(u>-1){var q=p.nodeValue.indexOf("}}",u+2);if(q===-1)throw Error("initGraph: invalid textNode: missing closing anchor, node.nodeValue: "+p.nodeValue);u>0&&(p=p.splitText(u),v.nextNode(),q-=u,u=0);q+2<p.nodeValue.length+u&&
p.splitText(q+2);const {A:K,h:E}=Y(p.nodeValue.slice(2,-2),n,4);U({l:p,s:"nodeValue",u:1,m:1,C:"",update:E,G:W,g:h,B:new Set},h,K.j)}}else if(u=p.tagName,u==="TEMPLATE")p.hasAttribute("id")||p.hasAttribute("shadowrootmode")?Pa(p,D):console.warn('initGraph: template has "shadowrootmode" or no "id" attribute, skipped:',p);else{if(p.hasAttribute("error")){q=A&&p===m?A:h;var y=q[J].path,z=Y(Z(p.getAttribute("error")),y,2,"__r_err");z.h||(z.h=new Function(y,"$r","$err",z.A.o));(p[B]??(p[B]={})).aa={g:q,
h:z.h}}if(p.hasAttribute("exec")&&(q=Y(Z(p.getAttribute("exec")),n,3),p.removeAttribute("exec"),xa(h,p,q),!p.parentElement))continue;p.hasAttribute("exec.async")&&(q=Y(Z(p.getAttribute("exec.async")),n,2,"__r_exa"),q.h||(q.h=new Aa(n,"$r",q.A.o)),p.removeAttribute("exec.async"),xa(h,p,q));if(u==="SLOT"&&m[B].L)u=h,q=m[B].L,q.g?(y=q.V.cloneNode(!0),z=q.g[C],q.g[C]=u[C],b(q.g,y),q.g[C]=z,p.before(y),p.remove()):console.error("setSlot: slotData.graph is null");else if(u.startsWith("R-"))u=u.slice(2).toLowerCase(),
p.hasAttribute("if")?d(p,p.getAttribute("if"),h,u,F):p.hasAttribute("f")?f(p,h,F):(p=Qa(p,D,void 0,F))&&g(p,h);else if(u=p.getAttribute("if"))d(p,u,h);else if(p.getAttribute("f"))f(p,h);else{if(u=p.getAttribute("ref"))if(q=p,y=h,u=Z(u),u.startsWith("$r.")){z=u.substring(3);var {A:G}=Y(z,y[J].path);if(G.j.length!==1||G.j[0]!==z)console.error("setRef: ref must be a simple var, got:",u);else{var {l:T,s:X}=va(z,y[N]);T===null?console.error("setRef: can not ensure path for varName:",u):(q=ya(q),y=y[J],
y.D&&3===y.D[B].I&&(y.T??(y.T=new Map)).set(u,q),T[X]=q)}}else console.error('setRef: varName must start with "$r.", got:',u);if(u=p.getAttribute("model")){if(p.tagName==="SELECT"&&p.childElementCount>0){if(q=p.lastElementChild)for(;v.nextNode()!==q;);b(h,p,!0)}q=p;y=u;z=h;switch(q.tagName){case "INPUT":switch(q.type){case "checkbox":gb(q,y,z);break;case "radio":ib(q,y,z);break;case "submit":case "button":case "reset":case "image":console.error("initModel: unsupported input type",q.type);break;default:db(q,
y,z)}break;case "TEXTAREA":db(q,y,z);break;case "SELECT":jb(q,y,z);break;default:console.error("initModel: unsupported tag",q.tagName)}}(u=p.getAttribute("view"))&&t(p,u,h);if(u=p.getAttribute("r-src"))p.removeAttribute("r-src"),p.setAttribute("src",u);for(const K of p.attributes)if(y=K.value.trim())if(z=K.name,z.startsWith("h:")||z.startsWith("h."))r(p,z,y,h);else if(z.startsWith("on:")||z.startsWith("on.async:"))k(p,z,y,A&&p===m?A:h);else if(!(!y.includes("{{")||kb.has(z)||z.startsWith("p:")||z.startsWith("pm:")||
z==="value"&&p.hasAttribute("model"))){u=[];q=[];G="";var H=1;for(let E=0,P=y.length;E<P;E++){const Q=y[E],V=y[E+1];if(Q==="{"&&V==="{"){if(H===2){console.warn("initGraph: bad attribute, nested {{ detected in :",y);H=3;break}G&&u.push(G);G="";H=2;E++}else H===2&&Q==="}"&&V==="}"?(q.push(u.length),u.push(G.trim()),G="",H=1,E++):G+=Q}switch(H){case 2:console.error("initGraph: bad attribute, unclosed {{ detected in :",y);case 3:continue;default:G&&u.push(G)}y=A&&p===m&&p[B]?.I===2&&p[B].ea.includes(z)?
A:h;z=y[J].path;if(u.length===1){const {A:E,h:P}=Y(u[0],z,4);U({l:K,s:"value",u:1,m:1,C:"",update:P,G:W,g:y,B:new Set},y,E.j,h[C])}else{for(let E=0,P=q.length;E<P;E++){G=q[E];const {A:Q,h:V}=Y(u[G],z,4);H=S(V,p,null,y[I],y[N]);U({l:K,s:"",u:1,m:1,C:H,H:{f:V,i:G,p:u},update:Ja,G:W,g:y,B:new Set},y,Q.j,h[C]);u[G]=H}K.value=u.join("")}}}}}function d(h,m,n,A,v){A=Z(m);const F=n[J].path;m=document.createComment(`if: ${A}`);m[B]={P:v};h.before(m);h.removeAttribute("if");h.remove();const {A:p,h:u}=Y(A,F,
4);h={anchor:m,W:n,ga:h,X:void 0,h:u,m:0,M:null};m.nextElementSibling?.hasAttribute("else")&&(v=m.nextElementSibling,v.removeAttribute("else"),v.remove(),h.X=v);U({l:h,s:"",u:1,m:1,update:e,G:function(){const q=this.l;q.M&&(ta(q.M,q.W),q.M=null);q.m=0},C:0,g:n,B:new Set},n,p.j)}function e(h,m,n){n=n.l;h=!!n.h.call(this,h,m)===!0?1:n.X?2:0;if(n.m!==h){n.m!==0&&n.M&&(ta(n.M,n.W),n.M=null);if(h!==0){m=Qa(h===1?n.ga:n.X,D,n.anchor,n.anchor[B]?.P);if(!m){n.M=null;n.m=0;return}const A=n.W;m=m[B].I===3?
l(m,A):g(m,A,!0);n.M=m;na(m)}n.m=h}}function f(h,m,n){var A=h.getAttribute("f"),v=Z(A).split("=>");if(v.length!==2)console.error('initFor: invalid "f" attribute',A);else{var F=v[0].trim(),[p,u]=v[1].replace(/\s*/g,"").split(",");v=/^[a-zA-Z_$][a-zA-Z0-9_$]*$/;if(!v.test(p)||u&&!v.test(u))console.error("initFor: invalid indexName or itemName",A);else{A=m[J].path;v=document.createComment(`for: ${F}`);if(h.hasAttribute("shadow")&&h.tagName.startsWith("R-")){var q=Ia(h.getAttribute("shadow"));q.attachShadow({mode:"open"}).appendChild(v);
h.removeAttribute("shadow");h.before(q)}else h.before(v);h.removeAttribute("f");h.remove();var {A:y,h:z}=Y(F,A,4),G=y.j.length;if(G===1&&y.j[0]===F){var T=ra(m,F);var X=y.j;q=m;var H=F.includes(".")?function(E){return z.call(null,E[I],E[N])}:function(E){return E[I][F]}}else{const E="l_"+Ca();q=Fa(void 0,m,!0);X=[E];if(G===0){try{H=z?.call(null)}catch(P){console.error("initFor: init error",", prop:",E,", err:",P)}q[I]=La({[E]:H},q[J].path,q);T=q[E]=sa(q);T[I]=q[I][E];H=function(){return T[I]}}else{const P=
q[I]=La({[E]:null},q[J].path,q);T=ra(q,E);H={l:P,s:E,m:1,u:2,C:null,update:z,G:W,g:m,B:new Set};U(H,m,y.j,q[C]);la(H,null);H=function(){return P[E]}}}if(T){T[da]||(T[da]={ha:b,h:H});H=[{name:p,type:2,o:""},{name:u,type:3,o:""}];if(h.tagName.startsWith("R-")){h.removeAttribute("p:"+p);h.removeAttribute("pm:"+p);u&&(h.removeAttribute("p:"+u),h.removeAttribute("pm:"+u));h=Ra(h,D,v,n);if(!h)return;n=h.attributes;for(let E=0;E<n.length;E++){var K=n[E];const P=K.name,Q=P.startsWith("p:")?1:P.startsWith("pm:")?
2:-1;if(Q===-1)continue;K=K.value;const V=Z(K),Za=P.substring(P.indexOf(":")+1);let $a=!0;if(/^\s*{{/.test(K)){const {A:Ea}=Y(V,A,4);if(Ea.j.length===1&&Ea.j[0]===V){H.push({name:Ha(Za),type:Q,o:V});continue}else Ea.j.length!==0&&($a=!1)}$a?H.push({name:Ha(Za),type:4,o:(new Function("return "+V))()}):console.error("initFor: only direct bindings are supported on list templates, skipped",P,"=",K)}}else h[B]={I:3};q!==m&&((q[L]??(q[L]={}))[ca]={g:m,h:()=>{},F:"",J:!0,O:X});m={l:T,s:"",u:5,m:1,H:{ba:H,
anchor:v,Z:h},update:Sa,G:W,C:null,g:q,B:new Set};U(m,q,X);G===0&&la(m,T[I])}else console.error("initFor: cannot create arrNode",", expr:",F)}}}function g(h,m,n=!1){var A=m[J].path;const v=Fa(h,m,n),F=v[J].path,p={};var u=[];for(let X=0,H=h.attributes.length;X<H;X++){var q=h.attributes[X],y=q.name;const K=y.startsWith("p:")?1:y.startsWith("pm:")?2:-1;if(K!==-1){y=Ha(y.substring(y.indexOf(":")+1));var z=q.value;q=Z(z);if(/^\s*{{/.test(z)){const {A:E,h:P}=Y(q,A,4);var G=E.j.length;if(G===1&&E.j[0]===
q){if(z=ra(m,q)){G=v[L]??(v[L]={});const Q=q.lastIndexOf(".");G[y]={g:m,h:new Function(A,"return "+A+(Q===-1?"":"."+q.substring(0,Q))),F:q.substring(Q+1),J:K===2};v[y]=z;continue}console.error("addTemplateRunners: missing linkToNode: cannot bind to expression",q)}if(G>0){z=v[J].fa;z||(z=Fa(void 0,v,!1),z[J].path=A+"_G"+v[J].path.substring(A.length+1),v[J].fa=z);G=z[I]??(z[I]=La({},z[J].path,z));G[x].target[y]=null;G={l:G,s:y,m:1,u:2,C:null,update:function(Q,V){Q=P.call(this,Q,V);return(V=Q?.[x])?
V.target:Q},G:W,g:m,B:new Set};U(G,m,E.j,z[C]);la(G,null);n||(G.m=1);v[y]=z[y];p[y]=void 0;(v[L]??(v[L]={}))[y]={g:z,h:function(Q){return Q},F:y,J:K===2};K===2&&console.error("addTemplateRunners: cannot two-way bind to non-simple expression",q);continue}p[y]=P()}else p[y]=(new Function(`return ${q}`))();u.push(y);K===2&&console.error("addTemplateRunners: cannot two way bind to non expression",q)}}A=v[I]=La(p,F,v);let T;h[B]?.N?.create&&(T=n?void 0:Object.keys(p),S(h[B].N.create,h,null,A,v[N]));b(v,
h,!1,m);if(!n){for(h=0;h<u.length;h++)m=u[h],A[m]=A[m];if(T)for(let X=Object.keys(p),H=0,K=X.length;H<K;H++)u=X[H],T.includes(u)||(A[u]=p[u])}return v}function l(h,m){const n=Fa(h,m,!0),A=n[J].path;n[L]={[ca]:{g:m,h:()=>{},F:"",J:!0}};!h[B].L&&m[J].D?.[B].L&&(h[B].L=m[J].D[B].L);n[I]=La({},A,n);b(n,h);return n}function k(h,m,n,A){var v=m.indexOf(":");v=v>0?m.substring(v+1):m.substring(1);h.removeAttribute(m);m=m.startsWith("on.async:");const F=A[J].path;n=Y(Z(n),F,2,"__r_l"+(m?"_a":""));n.h||(n.h=
m?new Aa(F,"$r","_","$evt",n.A.o):new Function(F,"$r","_","$evt",n.A.o));const p={l:h,s:"",u:4,m:1,C:"",update:n.h,G:()=>{},g:A,B:new Set};h.addEventListener(v,u=>{la(p,u)})}function r(h,m,n,A){const v=m.substring(m.indexOf(":")+1).replace(/-./g,y=>y[1].toUpperCase());if(v){if(m.startsWith("h:"))m=h[v];else if(m.startsWith("h.n:"))m=+h[v];else if(m.startsWith("h.b:"))m=h[v]==="true"?!0:!1;else if(m.startsWith("h.s:"))m=""+h[v];else{console.error("addSetter: invalid cast:",m);return}var F=A[J].path;
n=Z(n);var {A:p,h:u}=Y(n,F,4);if(p.j.length!==1||p.j[0]!==n)console.error("addSetter: invalid(non-simple) expression:",n);else{var {l:q}=va(n,A[I]);q===null?console.error("addSetter: invalid path:",n):(S(new Function(F,"$r","_v",`${p.o}=_v`),h,null,A[I],A[N],m),U({l:h,s:v,u:1,m:1,C:m,update:u,G:W,g:A,B:new Set},A,p.j))}}else console.error("addSetter: invalid prop:",m)}function t(h,m,n){const A=n[J].path;m=Z(m);const {A:v,h:F}=Y(m,A,4);if(v.j.length!==1||v.j[0]!==m)console.error('initView: only "simple" vars are supported: invalid varName:',
m);else{h.removeAttribute("view");h.hasAttribute("shadow")&&h.attachShadow({mode:"open"});h[B]={I:4};var p={l:{da:h,S:null,h:F},s:"",u:1,m:1,C:h.innerHTML,update:w,G:function(){const u=this.l;u.S&&(ta(u.S,this.g),u.S=null);u.da.innerHTML=p.C;u.S=null},g:n,B:new Set};U(p,n,v.j)}}function w(h,m,n){const A=n.l;var v=A.h.call(null,h,m);if(v&&Object.prototype.hasOwnProperty.call(v,"html")&&Object.prototype.hasOwnProperty.call(v,"state")){h=A.da;if(A.S)ta(A.S,n.g);else for(m=h.shadowRoot??h;m.lastChild;)m.removeChild(m.lastChild);
m=document.createElement("template");m.innerHTML=v.html;m=m.content;var F=m.querySelectorAll("script"),p;F.length>0&&(F.length!==1?console.error("template has more than one script tag, templateId:"," [view data]"):p=(new Function('"use strict";'+F[0].textContent+';return{create:typeof create==="function"?create:null,kill:typeof kill==="function"?kill:null}')).call(null),F.forEach(z=>z.remove()));F=v.readOnly!==!0;n=Fa(h,n.g,!0);n[I]=La({},n[J].path,n);v=v.state;var u=v[x].v,q={},y=function(z){return z};
for(const z in v)v.hasOwnProperty(z)&&(q[z]={g:u,h:y,F:z,J:F},n[z]=u[z]=sa(u));n[L]=q;p&&(h[B].N=p,p.create&&S(p.create,h,null,n[I],n[N]));b(n,m);na(n);(h.shadowRoot??h).appendChild(m);A.S=n}else console.error('updateData: view data must have "html" and "state" properties, got:',v),n.G()}const D=new Map;b(a,c)};export const R=function(a,c={},b,d){if(c===null||typeof c!=="object")throw Error("initial state must be an object");const e=Ca();a[B]={I:1};const f={[I]:null,[J]:{path:e,U:[],D:a}};f[N]=wa(d?{global:{},local:d}:{global:{}},a,f,!1);c=f[I]=La(c,e,f);b&&typeof b==="function"&&S(b,a,null,c,f[N]);lb(f,a);ia(c,f,e);a.hasAttribute("hidden")&&a.removeAttribute("hidden");return c};
